---
type LinkItem = {
  type: string;
  title: string;
  slug?: string;
  url?: string;
  fileId?: string | null;
  fileName?: string | null;
  fileSize?: number | null;
  fileType?: string | null;
  mimeType?: string | null;
} | null;

type NonNullableLinkItem = Exclude<LinkItem, null>;

function generateLink(type: string, slug?: string, url?: string) {
  switch (type) {
    case "article":
      return `/collection/detail/${slug}`;
    case "book":
      return `/book/detail/${slug}`;
    case "exhibition":
      return `/exhibition/detail/${slug}`;
    case "file":
      return url;
    default:
      return `/`;
  }
}

const {
  links = [],
  assets = [],
  title,
} = Astro.props as {
  links?: LinkItem[];
  assets?: LinkItem[];
  title?: string;
};

// 将links和assets的非空元素合并成一个数组
const mergedArray = links.reduce<NonNullableLinkItem[]>(
  (result, link, index) => {
    if (link !== null) {
      result.push(link);
    } else if (assets[index] !== null && assets[index] !== undefined) {
      result.push(assets[index] as NonNullableLinkItem);
    }
    return result;
  },
  [],
);
---

<div class="col-start-1 col-span-8 my-4 lg:my-16">
  <h2
    class="font-title font-bold text-3xl md:text-5xl text-neutral-900 mb-4 lg:mb-16"
  >
    {title ?? "Find out more"}
  </h2>
  <div class="flex flex-col gap-4">
    {
      mergedArray.map((page) => {
        const isFileLink = page.type === "file";
        return (
          <a
            href={generateLink(page.type, page.slug, page.url)}
            class="no-underline"
            target={`${page.url ? "_blank" : "_self"}`}
            rel={page.url ? "noopener noreferrer" : undefined}
            data-file-download={isFileLink ? "true" : undefined}
            data-file-id={isFileLink ? page.fileId ?? undefined : undefined}
            data-file-name={
              isFileLink ? page.fileName ?? page.title : undefined
            }
            data-file-type={
              isFileLink ? page.fileType ?? page.mimeType ?? undefined : undefined
            }
            data-file-size={
              isFileLink && page.fileSize ? String(page.fileSize) : undefined
            }
            data-file-context={isFileLink ? "page-block" : undefined}
          >
            <h3 class="mb-0 md:mb-2 lg:my-4 font-title font-bold text-2xl md:text-3xl text-neutral-900">
              {page.title}
            </h3>
            <p class="font-sans my-2 text-sm md:text-base text-neutral-900 opacity-50 capitalize">
              {page.type}
            </p>
          </a>
        );
      })
    }
  </div>
</div>
